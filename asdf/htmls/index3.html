<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gacha Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
        }
        .gacha-btn {
            background-color: #4a5568;
            color: #ffffff;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 9999px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .gacha-btn:hover {
            background-color: #2d3748;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.08);
        }
        .item-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            border-radius: 0.5rem;
            transition: transform 0.3s ease-in-out;
            animation: fadeIn 0.5s ease-in-out;
        }
        .star-3 { background-color: #4c51bf; }
        .star-4 { background-color: #63b3ed; }
        .star-5 { background-color: #ecc94b; }
        .star-5-pickup { background-color: #c53030; }
        .star-5-offpickup { background-color: #805ad5; }
        .pickup-text {
             background-color: #4299e1;
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 0.25rem;
             font-size: 0.75rem;
             margin-top: 0.5rem;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .item-image {
            width: 100px;
            height: 100px;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-2xl flex flex-col items-center space-y-6">
        <h1 class="text-4xl font-bold mb-4 text-center text-yellow-300">윤수 를 믿기</h1>

        <div class="w-full text-center p-4 rounded-md border border-gray-700">
            <h2 class="text-xl font-bold mb-2">게임 규칙</h2>
            <ul class="text-sm text-gray-400 space-y-1 text-left">
                <li>1회 뽑기는 160 쌀숭이재화가 소모되며, 10회 뽑기는 1600 재화가 소모됩니다.</li>
                <li>쌀숭이재화 획득 버튼을 누르면 80 재화를 얻습니다.</li>
                <li>10회 뽑기 시 최소 1개의 4성 아이템이 보장됩니다.</li>
                <li>10회 뽑기 시 5성 아이템은 최대 3개까지만 나옵니다.</li>
                <li>픽뚫 아이템이 나오면 다음 5성은 반드시 픽업 아이템으로 나옵니다.</li>
                <li>74회차부터 5성 확률이 증가하며, 90회차에는 5성이 확정으로 나옵니다.</li>
                <li>**5성이 나오면 5성 뽑기 횟수가 초기화됩니다.**</li>
            </ul>
        </div>
        
        <div class="w-full text-center p-4 rounded-md">
            <p class="text-lg font-semibold mb-2">5성 확률: <span id="probabilityDisplay" class="text-yellow-400">0.6%</span></p>
            <p class="text-lg font-semibold mb-2">총 뽑기 횟수: <span id="drawCountDisplay" class="text-yellow-400">0</span></p>
            <p class="text-lg font-semibold mb-2">5성 등장까지 뽑기 횟수: <span id="pityCountDisplay" class="text-yellow-400">0</span></p>
            <p class="text-lg font-semibold mb-2 flex items-center justify-center space-x-2">
                보유 재화: <span id="currencyDisplay" class="text-green-400">0</span>
                <img src="https://placehold.co/40x40/333333/FFFFFF?text=%EC%8C%80%EC%88%AD%EC%9D%B4" alt="쌀숭이재화" class="w-10 h-10 rounded-full">
            </p>
        </div>

        <div class="w-full flex justify-center space-x-4">
            <button id="getCurrencyButton" class="gacha-btn">쌀숭이재화 획득</button>
            <button id="drawButtonOne" class="gacha-btn">1회 뽑기 (160 쌀숭이재화)</button>
            <button id="drawButtonTen" class="gacha-btn">10회 뽑기 (1600 쌀숭이재화)</button>
        </div>
        
        <p id="message" class="text-red-400 font-bold hidden">재화가 부족합니다!</p>

        <div id="resultContainer" class="w-full p-4 rounded-md border border-gray-700 bg-gray-900 min-h-[150px] flex flex-wrap items-center justify-center gap-4">
            <p class="text-gray-400 text-center">결과가 여기에 표시됩니다.</p>
        </div>

        <div id="logContainer" class="w-full p-4 rounded-md border border-gray-700 bg-gray-900 max-h-64 overflow-y-auto">
            <h3 class="text-xl font-bold mb-2">뽑기 기록</h3>
            <ul id="logList" class="space-y-2 text-sm text-gray-300"></ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const getCurrencyButton = document.getElementById('getCurrencyButton');
            const drawButtonOne = document.getElementById('drawButtonOne');
            const drawButtonTen = document.getElementById('drawButtonTen');
            const resultContainer = document.getElementById('resultContainer');
            const logList = document.getElementById('logList');
            const probabilityDisplay = document.getElementById('probabilityDisplay');
            const drawCountDisplay = document.getElementById('drawCountDisplay');
            const pityCountDisplay = document.getElementById('pityCountDisplay');
            const currencyDisplay = document.getElementById('currencyDisplay');
            const messageDisplay = document.getElementById('message');

            let drawCount = 0; // 총 뽑기 횟수
            let pityCount = 0; // 5성 등장까지 뽑기 횟수
            let currentCurrency = 0;
            let guaranteedPickup = false;

            const COST_ONE = 160;
            const COST_TEN = 1600;
            const CURRENCY_PER_CLICK = 80;

            const itemPool = {
                '3성': { name: '3성 아이템', probability: 0 },
                '4성': { name: '4성 아이템', probability: 15.0 },
                '5성': { name: '5성 아이템', probability: 0.6 },
                '5성 픽업': { name: '5성 픽업 아이템', probability: 0 },
                '5성 픽뚫': { name: '5성 픽뚫 아이템', probability: 0 }
            };

            const itemNames = {
                '3성': ["천경", "무너진 행복", "전멸", "화살촉", "시위를 떠난 화살", "대립", "아카이브", "영험한 열쇠", "식견", "합창", "맞물린 톱니", "어울림", "그윽", "심연의 고리", "숨은 그림자", "수비", "앰버", "강토 개척", "풍작", "알찬 열매", "증식", "불타는 그림자", "추억 회상"],
                '4성': ["윤수의 울음", "팝핀윤수", "윤수의 칼", "윤수의 펜", "윤수의 깻잎", "윤수의 버즈", "윤수의 마우스", "윤수의 키보드", "윤수의 안경", "윤수의 배게", "윤수의 담요"],
                '5성 픽업': ["신 윤 수(GOD YOON-SU)"],
                '5성 픽뚫': ["어둠의 인도자 윤수오", "포켓 윤수", "아케이드 윤수", "프로젝트:윤수", "할로우 나이트 윤수", "대윤수", "K/DA 윤수", "HEARTSTEEL 윤수"]
            };

            const offPickupDescriptions = {
                "어둠의 인도자 윤수오": "그는 심연속에 산다",
                "포켓 윤수": "찾아라! 당신만의 카와이 윤수짱!",
                "아케이드 윤수": "일상에 지친 그대에게 단비같음을 선사해줍니다",
                "프로젝트:윤수": "아무도 믿지마.",
                "할로우 나이트 윤수": "미지의 땅에서 진실을 찾으라",
                "대윤수": "커다랗습니다",
                "K/DA 윤수": "당신만의 POP STAR 윤수를 감당할수있겠어요?",
                "HEARTSTEEL 윤수": "당신의 마음을 훔칠 Kpop demon"
            };

            const get5StarProbability = (count) => {
                if (count >= 90) return 100.0;
                if (count >= 74) {
                    const softPityProbabilities = {
                        74: 5.9, 75: 11.2, 76: 16.5, 77: 21.8, 78: 27.1, 79: 32.4, 80: 37.7, 81: 43.0,
                        82: 48.3, 83: 53.6, 84: 58.9, 85: 64.2, 86: 69.5, 87: 74.8, 88: 80.1, 89: 85.4, 90: 100.0
                    };
                    return softPityProbabilities[count] || 0.6;
                }
                return 0.6;
            };

            const calculateProbabilities = () => {
                const current5StarProb = get5StarProbability(pityCount + 1);
                itemPool['5성'].probability = current5StarProb;
                itemPool['4성'].probability = 15.0;
                itemPool['3성'].probability = 100.0 - itemPool['5성'].probability - itemPool['4성'].probability;
            };
            
            const drawTenGacha = () => {
                resultContainer.innerHTML = '';
                const results = [];
                let hasFourStar = false;
                let fiveStarCount = 0;

                for (let i = 0; i < 10; i++) {
                    const drawnItem = drawSingleItem();
                    results.push(drawnItem);
                    if (drawnItem.type.includes('5성')) {
                        fiveStarCount++;
                    }
                    if (drawnItem.type === '4성') {
                        hasFourStar = true;
                    }
                }
                
                // 10회 뽑기 4성 확정 보정
                if (!hasFourStar) {
                    const randomIndex = Math.floor(Math.random() * 10);
                    const list = itemNames['4성'];
                    results[randomIndex] = {
                        type: '4성',
                        name: list[Math.floor(Math.random() * list.length)]
                    };
                }

                // 10회 뽑기 5성 최대 3개 제한
                while(fiveStarCount > 3) {
                    const fiveStarIndex = results.findIndex(item => item.type.includes('5성'));
                    if (fiveStarIndex !== -1) {
                        const list = itemNames['3성'];
                        results[fiveStarIndex] = {
                            type: '3성',
                            name: list[Math.floor(Math.random() * list.length)]
                        };
                        fiveStarCount--;
                    }
                }

                displayTenResults(results);
            };

            const drawSingleItem = () => {
                drawCount++;
                pityCount++;
                drawCountDisplay.textContent = drawCount;
                pityCountDisplay.textContent = pityCount;
                calculateProbabilities();
                probabilityDisplay.textContent = `${itemPool['5성'].probability.toFixed(2)}%`;

                const rand = Math.random() * 100;
                let cumulativeProb = 0;
                let drawnItem = null;

                const tiers = ['5성', '4성', '3성'];
                for (const tier of tiers) {
                    cumulativeProb += itemPool[tier].probability;
                    if (rand < cumulativeProb) {
                        drawnItem = tier;
                        break;
                    }
                }
                
                let itemName = '';
                if (drawnItem === '5성') {
                    const isPickup = guaranteedPickup || (Math.random() < 0.5);
                    const pickupType = isPickup ? '5성 픽업' : '5성 픽뚫';
                    const list = itemNames[pickupType];
                    itemName = list[Math.floor(Math.random() * list.length)];
                    if (!isPickup) {
                       guaranteedPickup = true;
                    } else {
                       guaranteedPickup = false;
                    }
                    // 5성 등장 시 5성 뽑기 횟수 초기화
                    pityCount = 0;
                    return { type: pickupType, name: itemName };
                } else if (drawnItem === '4성') {
                    const list = itemNames['4성'];
                    itemName = list[Math.floor(Math.random() * list.length)];
                    return { type: '4성', name: itemName };
                } else {
                    const list = itemNames['3성'];
                    itemName = list[Math.floor(Math.random() * list.length)];
                    return { type: '3성', name: itemName };
                }
            };

            const displayResult = (itemKey, itemName) => {
                resultContainer.innerHTML = '';
                const itemDiv = document.createElement('div');
                itemDiv.className = `item-card p-6 rounded-xl shadow-xl transition-all duration-300 transform scale-105 ${
                    itemKey === '5성 픽업' ? 'star-5-pickup' :
                    itemKey === '5성 픽뚫' ? 'star-5-offpickup' :
                    itemKey === '5성' ? 'star-5' :
                    itemKey === '4성' ? 'star-4' : 'star-3'
                }`;
                let imageHtml = '';
                if (itemName === '신 윤 수(GOD YOON-SU)') {
                    imageHtml = `<img src="https://placehold.co/100x100/333333/FFFFFF?text=GOD+YOON-SU" alt="신 윤 수(GOD YOON-SU)" class="item-image">`;
                }

                itemDiv.innerHTML = `
                    ${imageHtml}
                    <p class="text-3xl font-bold mb-2">${itemKey.replace('성 픽업', '성').replace('성 픽뚫', '성')}</p>
                    <p class="text-md text-center">${itemName}</p>
                `;
                if (itemKey === '5성 픽업') {
                    const pickupBadge = document.createElement('div');
                    pickupBadge.className = 'pickup-text bg-red-600';
                    pickupBadge.textContent = '픽업 아이템';
                    itemDiv.appendChild(pickupBadge);
                    if (itemName === '신 윤 수(GOD YOON-SU)') {
                         const description = document.createElement('p');
                         description.className = 'text-sm text-yellow-200 mt-2 text-center';
                         description.textContent = '그는 최초이자 마지막 신, 세상을 파멸시킬 안경잡이, 심연의 주시자이다.';
                         itemDiv.appendChild(description);
                    }
                } else if (itemKey === '5성 픽뚫') {
                    const offPickupBadge = document.createElement('div');
                    offPickupBadge.className = 'pickup-text bg-purple-600';
                    offPickupBadge.textContent = '픽뚫 아이템';
                    itemDiv.appendChild(offPickupBadge);

                    const description = offPickupDescriptions[itemName];
                    if (description) {
                         const descElem = document.createElement('p');
                         descElem.className = 'text-sm text-purple-200 mt-2 text-center';
                         descElem.textContent = description;
                         itemDiv.appendChild(descElem);
                    }
                }
                resultContainer.appendChild(itemDiv);
            };

            const displayTenResults = (results) => {
                resultContainer.innerHTML = '';
                results.forEach(result => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `item-card p-4 rounded-lg shadow-lg flex-grow w-[45%] md:w-[30%] ${
                        result.type === '5성 픽업' ? 'star-5-pickup' :
                        result.type === '5성 픽뚫' ? 'star-5-offpickup' :
                        result.type === '5성' ? 'star-5' :
                        result.type === '4성' ? 'star-4' : 'star-3'
                    }`;
                    let imageHtml = '';
                    if (result.name === '신 윤 수(GOD YOON-SU)') {
                        imageHtml = `<img src="https://placehold.co/100x100/333333/FFFFFF?text=GOD+YOON-SU" alt="신 윤 수(GOD YOON-SU)" class="item-image">`;
                    }
                    
                    itemDiv.innerHTML = `
                        ${imageHtml}
                        <p class="text-xl font-bold mb-1">${result.type.replace('성 픽업', '성').replace('성 픽뚫', '성')}</p>
                        <p class="text-sm text-center">${result.name}</p>
                    `;
                    if (result.type === '5성 픽업') {
                        const pickupBadge = document.createElement('div');
                        pickupBadge.className = 'pickup-text bg-red-600';
                        pickupBadge.textContent = '픽업';
                        itemDiv.appendChild(pickupBadge);
                        if (result.name === '신 윤 수(GOD YOON-SU)') {
                             const description = document.createElement('p');
                             description.className = 'text-xs text-yellow-200 mt-1 text-center';
                             description.textContent = '그는 최초이자 마지막 신, 세상을 파멸시킬 안경잡이, 심연의 주시자이다.';
                             itemDiv.appendChild(description);
                        }
                    } else if (result.type === '5성 픽뚫') {
                        const offPickupBadge = document.createElement('div');
                        offPickupBadge.className = 'pickup-text bg-purple-600';
                        offPickupBadge.textContent = '픽뚫';
                        itemDiv.appendChild(offPickupBadge);

                        const description = offPickupDescriptions[result.name];
                        if (description) {
                            const descElem = document.createElement('p');
                            descElem.className = 'text-xs text-purple-200 mt-1 text-center';
                            descElem.textContent = description;
                            itemDiv.appendChild(descElem);
                        }
                    }
                    resultContainer.appendChild(itemDiv);
                    addLog(result.type, result.name);
                });
            };

            const addLog = (itemKey, itemName) => {
                const logItem = document.createElement('li');
                logItem.className = 'flex items-center space-x-2';
                const colorIndicator = document.createElement('span');
                colorIndicator.className = `w-3 h-3 rounded-full ${
                    itemKey === '5성 픽업' ? 'bg-red-500' :
                    itemKey === '5성 픽뚫' ? 'bg-purple-500' :
                    itemKey === '5성' ? 'bg-yellow-500' :
                    itemKey === '4성' ? 'bg-blue-500' : 'bg-indigo-500'
                }`;
                logItem.innerHTML = `<span class="text-gray-400">[${drawCount}회차]</span> ${itemKey.replace('성 픽업', '성').replace('성 픽뚫', '성')}: ${itemName}`;
                logItem.prepend(colorIndicator);
                logList.prepend(logItem);
                if (logList.children.length > 50) {
                    logList.removeChild(logList.lastChild);
                }
            };

            getCurrencyButton.addEventListener('click', () => {
                currentCurrency += CURRENCY_PER_CLICK;
                currencyDisplay.textContent = currentCurrency;
                messageDisplay.classList.add('hidden');
            });
            
            drawButtonOne.addEventListener('click', () => {
                if (currentCurrency >= COST_ONE) {
                    currentCurrency -= COST_ONE;
                    currencyDisplay.textContent = currentCurrency;
                    messageDisplay.classList.add('hidden');
                    
                    resultContainer.innerHTML = '';
                    const result = drawSingleItem();
                    displayResult(result.type, result.name);
                    addLog(result.type, result.name);
                } else {
                    messageDisplay.classList.remove('hidden');
                }
            });
            
            drawButtonTen.addEventListener('click', () => {
                if (currentCurrency >= COST_TEN) {
                    currentCurrency -= COST_TEN;
                    currencyDisplay.textContent = currentCurrency;
                    messageDisplay.classList.add('hidden');
                    drawTenGacha();
                } else {
                    messageDisplay.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>
